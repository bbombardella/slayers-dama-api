generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [pg_trgm]
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  password     String
  googleId     String?  @unique
  microsoftId  String?  @unique
  refreshToken String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Genre {
  id        Int              @id @default(autoincrement())
  title     String
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  movies    GenresOnMovies[]
}

model Movie {
  id           Int              @id @default(autoincrement())
  title        String
  release_date DateTime
  overview     String
  popularity   Decimal
  vote_average Decimal
  budget       Decimal
  poster_path  String
  tagline      String
  tmdb_id      Int              @unique
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  genres       GenresOnMovies[]

  @@index([title(ops: raw("gin_trgm_ops"))], type: Gin)
  @@index([tagline(ops: raw("gin_trgm_ops"))], type: Gin)
  @@index([overview(ops: raw("gin_trgm_ops"))], type: Gin)
}

model GenresOnMovies {
  movieId Int
  movie   Movie @relation(fields: [movieId], references: [id])
  genreId Int
  genre   Genre @relation(fields: [genreId], references: [id])

  @@id([movieId, genreId])
}
